



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="迩彧博客" href="https://muxiaoximuxiaoxi.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="迩彧博客" href="https://muxiaoximuxiaoxi.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="迩彧博客" href="https://muxiaoximuxiaoxi.github.io/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  

<link rel="canonical" href="https://muxiaoximuxiaoxi.github.io/2024/10/20/display%E6%A8%A1%E5%9D%97%E8%AE%B2%E8%A7%A3/">



  <title>
 |
Yume Shoka = 迩彧博客</title>
<meta name="generator" content="Hexo 6.0.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2024-10-20 12:09:40">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2024-10-20T12:09:40+08:00">2024-10-20</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Yume Shoka</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipesrnqv3j20zk0m8ava.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicljgocqbj20zk0m8e81.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclimtf7dj20zk0m8qav.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclga70tsj20zk0m84mr.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipey84bjtj20zk0m8hdt.jpg"></li>
          <li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipev1x5e4j20zk0m8b29.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="https://muxiaoximuxiaoxi.github.io/2024/10/20/display%E6%A8%A1%E5%9D%97%E8%AE%B2%E8%A7%A3/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="迩彧">
    <meta itemprop="description" content=", 与其临渊羡鱼，不如退而结网">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="迩彧博客">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h2 id="x3D"><a href="#x3D" class="headerlink" title="&#x3D;"></a>&#x3D;</h2><p>layout: _驱动子系统<br>title: display模块讲解<br>date: 2024-04-28 21:04:32<br>categories: </p>
<ul>
<li>_驱动子系统<br>tags:</li>
</ul>
<hr>
<h3 id="driver"><a href="#driver" class="headerlink" title="driver"></a>driver</h3><ol>
<li><p><code>drivers_adapter</code><br>存放 OpenHarmony 驱动子系统内核或者用户态驱动框架和编译脚本，即提供框架能力</p>
</li>
<li><p><code>drivers_framework</code><br>存放 OpenHarmony 驱动子系统核心源码(驱动框架、配置管理、驱动框架模型)</p>
</li>
<li><p><code>drivers_interface</code><br>管理各模块 HDI(Hardware Device Interface)<br>该仓库用于管理各模块HDI(Hardware Device Interface)接口定义，接口定义使用IDL语言描述并以·idl文件形式保存。</p>
</li>
<li><p><code>drivers_liteos</code><br>内核驱动，负责软硬件间的交互</p>
</li>
<li><p><code>drivers_peripheral</code><br>负责各外设器件驱动的相关HDI（Harware Driver Interface）接口、HAL实现、驱动模型及测试用例</p>
</li>
</ol>
<h3 id="drivers-adapter"><a href="#drivers-adapter" class="headerlink" title="drivers_adapter"></a>drivers_adapter</h3><p>该仓主要存放OpenHarmony驱动子系统内核或用户态驱动框架的代码和编译脚本，提供驱动框架的能力。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/drivers/adapter</span><br><span class="line">├── khdf/liteos         #提供驱动框架对LiteOS-A内核依赖适配</span><br><span class="line">├── khdf/liteos_m       #提供驱动框架对LiteOS-M内核依赖适配</span><br><span class="line">├── uhdf                #提供用户态驱动接口对系统依赖适配</span><br><span class="line">└── uhdf2               #提供用户态驱动框架对系统依赖适配</span><br></pre></td></tr></table></figure>

<h3 id="drivers-framework"><a href="#drivers-framework" class="headerlink" title="drivers_framework"></a>drivers_framework</h3><h5 id="drivers-framework-x2F-model-x2F-display-x2F-driver"><a href="#drivers-framework-x2F-model-x2F-display-x2F-driver" class="headerlink" title="drivers_framework&#x2F; model &#x2F; display &#x2F; driver"></a>drivers_framework&#x2F; model &#x2F; display &#x2F; driver</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">drivers\framework\model\display\driver</span><br><span class="line">Driver</span><br><span class="line">├── adapter_soc//适配目录</span><br><span class="line">├── backlight// 背光目录</span><br><span class="line">├── panel//  屏幕目录</span><br><span class="line">├── hdf_disp.c  // l2版本代码   </span><br><span class="line">├── hdf_disp.h          </span><br><span class="line">├── hdf_drm_panel.c  //实现panel和内核直接的交互     </span><br><span class="line">└── hdf_drm_panel.h  </span><br></pre></td></tr></table></figure>
<ul>
<li>adapter_soc</li>
</ul>
<p>3516适配</p>
<p>hi35xx_disp.h &amp; hi35xx_disp.cpp</p>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>static void MipiMuxCfg(unsigned long ioCfgBase)</td>
<td>MipiMuxC配置信息</td>
<td>ioCfg基础信息</td>
</tr>
<tr>
<td>static void Lcd6BitMuxCfg(unsigned long ioCfgBase)</td>
<td>Lcd6BitMux配置信息</td>
<td>ioCfg基础信息</td>
</tr>
<tr>
<td>static void Lcd8BitMuxCfg(unsigned long ioCfgBase)</td>
<td>Lcd8BitMux配置信息</td>
<td>ioCfg基础信息</td>
</tr>
<tr>
<td>void Lcd24BitMuxCfg(unsigned long ioCfgBase)</td>
<td>Lcd24BitMux配置信息</td>
<td>ioCfg基础信息</td>
</tr>
<tr>
<td>static void LcdPinMuxCfg(uint32_t intf)</td>
<td>Lcd显示配置</td>
<td>Lcd接口类型</td>
</tr>
<tr>
<td>static void PwmPinMuxCfg(uint32_t dev)</td>
<td>Pwm脉冲配置</td>
<td>脉冲设备名称</td>
</tr>
<tr>
<td>static int32_t GetBitsPerPixel(enum DsiOutFormat format)</td>
<td>获取PerPixer逐像素位数</td>
<td>Mipi输出格式</td>
</tr>
<tr>
<td>static uint32_t CalcPixelClk(struct PanelInfo *info)</td>
<td>Pixel计时</td>
<td>屏幕信息</td>
</tr>
<tr>
<td>static uint32_t CalcDataRate(struct PanelInfo *info)</td>
<td>计算数据率</td>
<td>屏幕信息</td>
</tr>
<tr>
<td>static int32_t MipiDsiInit(struct PanelInfo *info)</td>
<td>Mipi显示初始化</td>
<td>屏幕信息</td>
</tr>
<tr>
<td>static int32_t GetLcdIntfType(enum LcdIntfType type, uint32_t *out)</td>
<td>获取Lcd接口类型</td>
<td>Lcd接口类型 输出接口类型</td>
</tr>
<tr>
<td>static int32_t Hi35xxHardWareInit(void)</td>
<td>hi3516初始化</td>
<td>无</td>
</tr>
<tr>
<td>static int32_t Hi35xxEntryInit(struct HdfDeviceObject *object)</td>
<td>hi3516初始化入口</td>
<td>Hdf设备对象</td>
</tr>
</tbody></table>
<ul>
<li>backlight 背光<br>hdf_bl.h &amp; hdf_bl.cpp</li>
</ul>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>static struct BacklightDev *BlDevInstance(const char *devName,struct BacklightProperties *props, struct BacklightOps *ops)</td>
<td>BlDev实例化</td>
<td>背光名字 背光属性 背光Ops</td>
</tr>
<tr>
<td>struct BacklightDev *RegisterBlDev(const char *name, struct BacklightProperties *props,struct BacklightOps *ops, struct HdfDeviceObject *object)</td>
<td>背光注册</td>
<td>背光名字 背光属性 背光Ops Hdf设备对象</td>
</tr>
<tr>
<td>int32_t UnRegisterBlDev(struct BacklightDev *blDev)</td>
<td>背光注销</td>
<td>Hdf设备对象</td>
</tr>
<tr>
<td>void *ToBlDevPriv(struct BacklightDev *blDev)</td>
<td>获取背光PrivPriv</td>
<td>背光设备</td>
</tr>
<tr>
<td>struct BacklightDev *GetBacklightDev(const char *name)</td>
<td>获取背光设备信息</td>
<td>背光名字</td>
</tr>
<tr>
<td>int32_t UpdateBacklightState(struct BacklightDev *blDev, enum FbPowerStatus status)</td>
<td>更新背光状态</td>
<td>背光设备 背光状态</td>
</tr>
<tr>
<td>int32_t UpdateBrightness(struct BacklightDev *blDev, uint32_t brightness)</td>
<td>更新背光等级</td>
<td>背光设备 背光等级</td>
</tr>
<tr>
<td>static uint32_t GetBlDevBrightness(struct BacklightDev *blDev, enum BrightnessType type)</td>
<td>获取背光等级</td>
<td>背光设备 背光等级</td>
</tr>
<tr>
<td>int32_t GetMinBrightness(struct BacklightDev *blDev, uint32_t *brightness)</td>
<td>获取Min背光</td>
<td>背光设备 背光等级</td>
</tr>
<tr>
<td>int32_t GetCurrBrightness(struct BacklightDev *blDev, uint32_t *brightness)</td>
<td>获取Cur背光</td>
<td>背光设备 背光等级</td>
</tr>
<tr>
<td>int32_t GetDefBrightness(struct BacklightDev *blDev, uint32_t *brightness)</td>
<td>获取Def背光</td>
<td>背光设备 背光等级</td>
</tr>
<tr>
<td>int32_t GetMaxBrightness(struct BacklightDev *blDev, uint32_t *brightness)</td>
<td>获取Max背光</td>
<td>背光设备 背光等级</td>
</tr>
<tr>
<td>static int32_t HdfGetBrightness(enum BrightnessType type,struct HdfSBuf *reqData, struct HdfSBuf *rspData)</td>
<td>获取Hdf背光等级</td>
<td>背光等级 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t HdfGetMinBrightness(struct HdfDeviceObject *device,struct HdfSBuf *reqData, struct HdfSBuf *rspData)</td>
<td>获取Hdg MIn背光</td>
<td>Hdf设备对象 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t HdfGetCurrBrightness(struct HdfDeviceObject *device,struct HdfSBuf *reqData, struct HdfSBuf *rspData)</td>
<td>获取Hdf Cur背光</td>
<td>Hdf设备对象 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t HdfGetDefBrightness(struct HdfDeviceObject <em>device,struct HdfSBuf</em>reqData, struct HdfSBuf *rspData)</td>
<td>获取Hdf Def背光</td>
<td>Hdf设备对象 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t HdfGetMaxBrightness(struct HdfDeviceObject *device,struct HdfSBuf *reqData, struct HdfSBuf *rspData)</td>
<td>获取Hdf Max背光</td>
<td>Hdf设备对象 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t HdfSetBrightness(struct HdfDeviceObject *device,struct HdfSBuf *reqData, struct HdfSBuf *rspData)</td>
<td>设置Hdf背光等级</td>
<td>Hdf设备对象 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t HdfGetDListHead(struct HdfDeviceObject *device,struct HdfSBuf *reqData, struct HdfSBuf *rspData)</td>
<td>获取Hdf 背光链表</td>
<td>Hdf设备对象 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t BacklightDispatch(struct HdfDeviceIoClient *client, int cmd, struct HdfSBuf *data,struct HdfSBuf *reply)</td>
<td>背光调度</td>
<td>Hdf 设备io客户端对象 cmd HdfBuf数据 HdfBuf答复数据</td>
</tr>
<tr>
<td>static int BacklightBind(struct HdfDeviceObject *dev)</td>
<td>背光绑定</td>
<td>Hdf设备对象</td>
</tr>
<tr>
<td>static int32_t BacklightInit(struct HdfDeviceObject *object)</td>
<td>背光初始化</td>
<td>Hdf设备对象</td>
</tr>
</tbody></table>
<p>pwm_bl.cpp</p>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>static int32_t BlPwmUpdateBrightness(struct BacklightDev *blDev, uint32_t brightness)</td>
<td>BlPwm更新背光等级</td>
<td>背光设备 背光等级</td>
</tr>
<tr>
<td>static int32_t ParsePwmNum(const struct DeviceResourceNode *node, uint8_t *pwmNum)</td>
<td>解析PwNum</td>
<td>设备资源树节点 pwmNum</td>
</tr>
<tr>
<td>static int32_t ParseBlPwmCfg(const struct DeviceResourceNode *node, struct BlPwmDev *blPwmDev)</td>
<td>解析BlPwm配置</td>
<td>设备资源树节点 BlPwm设备</td>
</tr>
<tr>
<td>static int32_t BlPwmDevInit(struct HdfDeviceObject *object, struct BlPwmDev *blPwmDev)</td>
<td>BlPwm设备初始化</td>
<td>Hdf设备对象 BlPwm设备</td>
</tr>
<tr>
<td>static int32_t BlPwmEntryInit(struct HdfDeviceObject *object)</td>
<td>BlPwm初始化入口</td>
<td>Hdf设备对象</td>
</tr>
<tr>
<td>static void BlPwmEntryRelease(struct HdfDeviceObject *object)</td>
<td>BlPwm注销入口</td>
<td>Hdf设备对象</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">struct BacklightDev &#123;</span><br><span class="line">    char name[MAX_BL_NAME_LEN];</span><br><span class="line">    struct BacklightProperties props;</span><br><span class="line">    struct BacklightOps *ops;</span><br><span class="line">    struct OsalMutex mutex;</span><br><span class="line">    bool isRegister;</span><br><span class="line">    void *priv;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct BlPwmDev &#123;</span><br><span class="line">    const char *name;</span><br><span class="line">    uint8_t pwmDevNum;</span><br><span class="line">    DevHandle pwmHandle;</span><br><span class="line">    struct PwmConfig config;</span><br><span class="line">    struct BacklightProperties props;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<ul>
<li>panel 屏幕</li>
</ul>
<p>ili9881_st_5p5.h &amp; ili9881_st_5p5.c</p>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>static struct panel_ili9881_dev *ToPanelSimpleDev(const struct PanelData *panel)</td>
<td>获取ili9881屏幕的priv</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t panel_simple_regulator_enable(void)</td>
<td>屏幕简单开启</td>
<td>无</td>
</tr>
<tr>
<td>static int32_t panel_simple_regulator_disable(void)</td>
<td>屏幕简单关闭</td>
<td>无</td>
</tr>
<tr>
<td>int panel_simple_loader_protect(struct drm_panel *panel)</td>
<td>屏幕加载保护</td>
<td>内核驱动信息</td>
</tr>
<tr>
<td>static int32_t PanelSendCmds(struct mipi_dsi_device *dsi,const struct DsiCmdDesc *cmds, int size)</td>
<td>屏幕发送cmd指令</td>
<td>MipiDSI设备 DsiCmd排序序列 序列大小</td>
</tr>
<tr>
<td>static int32_t PanelOn(struct PanelData *panel)</td>
<td>亮屏</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t PanelOff(struct PanelData *panel)</td>
<td>灭屏</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t PanelPrepare(struct PanelData *panel)</td>
<td>屏幕准备</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t PanelUnprepare(struct PanelData *panel)</td>
<td>屏幕反准备</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t PanelInit(struct PanelData *panel)</td>
<td>屏幕初始化</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static void PanelResInit(struct panel_ili9881_dev *panel_dev)</td>
<td>屏幕ili9881初始化</td>
<td>屏幕ili9881信息</td>
</tr>
<tr>
<td>int32_t PanelEntryInit(struct HdfDeviceObject *object)</td>
<td>屏幕初始化入口</td>
<td>Hdf设备对象</td>
</tr>
</tbody></table>
<p>ili9881c_boe.h &amp; ili9881c_boe.c</p>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>static int Ili9881cBoeSendCmds(struct mipi_dsi_device *dsi,const struct DsiCmdDesc *cmds, int size)</td>
<td>屏幕发送cmd指令</td>
<td>MipiDSI设备 DsiCmd排序序列 序列大小</td>
</tr>
<tr>
<td>static struct Ili9881cBoeDev *ToIli9881cBoeDev(const struct PanelData *panel)</td>
<td>获取Ili9881c priv</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static SetGpioState(uint16_t gpio, uint16_t dir, uint16_t level, uint32_t delay)</td>
<td>设置Gpio状态</td>
<td>通用io 目录 等级 延期</td>
</tr>
<tr>
<td>static int32_t Ili9881cBoePrepare(const struct Ili9881cBoeDev *ili9881cBoeDev)</td>
<td>Ili9881cBoe屏幕准备</td>
<td>Ili9881cBoe屏幕信息</td>
</tr>
<tr>
<td>static int32_t Ili9881cBoeUnprepare(const struct Ili9881cBoeDev *ili9881cBoeDev)</td>
<td>Ili9881cBoe屏幕反准备</td>
<td>Ili9881cBoe屏幕信息</td>
</tr>
<tr>
<td>static int32_t Ili9881cBoeOn(struct PanelData *panel)</td>
<td>亮屏</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t Ili9881cBoeOff(struct PanelData *panel)</td>
<td>灭屏</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t Ili9881cBoeInit(struct PanelData *panel)</td>
<td>屏幕初始化</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static void Ili9881cBoeResInit(struct Ili9881cBoeDev *ili9881cBoeDev)</td>
<td>屏幕ili9881Boe初始化</td>
<td>屏幕ili9881Boe信息</td>
</tr>
<tr>
<td>int32_t Ili9881cBoeEntryInit(struct HdfDeviceObject *object)</td>
<td>屏幕初始化入口</td>
<td>Hdf设备对象</td>
</tr>
</tbody></table>
<p>mipi_icn9700.c</p>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>static int32_t LcdResetOn(struct Icn9700Dev *icn9700)</td>
<td>Lcd重置开启</td>
<td>屏幕Icn9700Dev信息</td>
</tr>
<tr>
<td>static int32_t LcdResetOff(struct Icn9700Dev *icn9700)</td>
<td>Lcd重置关闭</td>
<td>屏幕Icn9700Dev信息</td>
</tr>
<tr>
<td>static struct Icn9700Dev *PanelToIcn9700Dev(const struct PanelData *panel)</td>
<td>获取Icn9700 priv</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t Icn9700Init(struct PanelData *panel)</td>
<td>Icn9700初始化</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t Icn9700On(struct PanelData *panel)</td>
<td>Icn9700亮屏</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t Icn9700Off(struct PanelData *panel)</td>
<td>Icn9700灭屏</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t Icn9700EsdCheckFunc(struct PanelData *panel)</td>
<td>Icn9700屏幕电子检查函数</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static void Icn9700PanelInit(struct PanelData *panel)</td>
<td>Icn9700初始化</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>int32_t Icn9700EntryInit(struct HdfDeviceObject *object)</td>
<td>Icn9700初始化入口</td>
<td>Hdf设备对象</td>
</tr>
</tbody></table>
<p>ssp_st7789.h &amp; ssp_st7789.c</p>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>static int32_t SpiWrite9Bits(DevHandle spiHandle, uint8_t cmd, uint8_t data)</td>
<td>Spi以9bits的形式写</td>
<td>spi句柄 cmd 数据</td>
</tr>
<tr>
<td>DevHandle GetSpiHandle(void)</td>
<td>获取Spi句柄</td>
<td>无</td>
</tr>
<tr>
<td>static int32_t LcdResetOn(void)</td>
<td>Lcd重置开启</td>
<td>无</td>
</tr>
<tr>
<td>static int32_t LcdResetOff(void)</td>
<td>Lcd重置关闭</td>
<td>无</td>
</tr>
<tr>
<td>static int32_t St7789Init(void)</td>
<td>St7789初始化</td>
<td>无</td>
</tr>
<tr>
<td>static int32_t St7789On(void)</td>
<td>St7789亮屏</td>
<td>无</td>
</tr>
<tr>
<td>static int32_t St7789Off(void)</td>
<td>St7789灭屏</td>
<td>无</td>
</tr>
<tr>
<td>static int32_t St7789SetBacklight(uint32_t level)</td>
<td>设置St7789背光</td>
<td>背光等级</td>
</tr>
<tr>
<td>int32_t SspSt7789EntryInit(struct HdfDeviceObject *object)</td>
<td>SspSt7789初始化入口</td>
<td>Hdf设备对象</td>
</tr>
</tbody></table>
<ul>
<li>hdf_disp.h &amp; hdf_disp.c</li>
</ul>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>int32_t RegisterPanel(struct PanelData *panel)</td>
<td>屏幕注册</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>struct PanelManager *GetPanelManager(void)</td>
<td>获取屏幕管理</td>
<td>无</td>
</tr>
<tr>
<td>struct DispManager *GetDispManager(void)</td>
<td>获取显示管理</td>
<td>无</td>
</tr>
<tr>
<td>struct DispOperations *GetDispOps(void)</td>
<td>获取显示Ops</td>
<td>无</td>
</tr>
<tr>
<td>static int32_t InitDisp(uint32_t devId)</td>
<td>显示初始化</td>
<td>显示ID</td>
</tr>
<tr>
<td>int32_t DispOn(uint32_t devId)</td>
<td>亮屏</td>
<td>显示ID</td>
</tr>
<tr>
<td>int32_t DispOff(uint32_t devId)</td>
<td>灭屏</td>
<td>显示ID</td>
</tr>
<tr>
<td>int32_t SetDispBacklight(uint32_t devId, uint32_t level)</td>
<td>设置显示背光</td>
<td>显示ID 背光等级</td>
</tr>
<tr>
<td>static int32_t GetDispInfo(uint32_t devId, struct DispInfo *info)</td>
<td>获取显示信息</td>
<td>显示ID 显示信息</td>
</tr>
<tr>
<td>static int32_t SetDispPower(uint32_t devId, uint32_t powerStatus)</td>
<td>设置显示权限状态</td>
<td>显示ID piwer状态</td>
</tr>
<tr>
<td>static int32_t SetPowerStatus(struct HdfDeviceObject *device, struct HdfSBuf *reqData, struct HdfSBuf *rspData)</td>
<td>设置power状态</td>
<td>Hdf设备对象 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t GetPowerStatus(struct HdfDeviceObject *device, struct HdfSBuf *reqData, struct HdfSBuf *rspData)</td>
<td>获取power状态</td>
<td>Hdf设备对象 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t SetBacklight(struct HdfDeviceObject *device, struct HdfSBuf *reqData, struct HdfSBuf *rspData)</td>
<td>设置背光</td>
<td>Hdf设备对象 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t GetBacklight(struct HdfDeviceObject *device, struct HdfSBuf *reqData, struct HdfSBuf *rspData)</td>
<td>获取背光</td>
<td>Hdf设备对象 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t GetInfo(struct HdfDeviceObject *device, struct HdfSBuf *reqData, struct HdfSBuf *rspData)</td>
<td>获取info信息</td>
<td>Hdf设备对象 HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t DispCmdProcess(struct HdfDeviceObject *device, int32_t cmd, struct HdfSBuf *reqData,struct HdfSBuf *rspData)</td>
<td>屏幕发送cmd指令</td>
<td>Hdf设备对象 cmd HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static int32_t HdfDispDispatch(struct HdfDeviceIoClient *client, int id, struct HdfSBuf *data,struct HdfSBuf *reply)</td>
<td>Hdf显示调度</td>
<td>Hdf设备客户端 id HdfBuf发送数据 HdfBuf接受数据</td>
</tr>
<tr>
<td>static void PanelRecovery(struct PanelData *panel)</td>
<td>屏幕恢复</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static void EsdTimerHandler(uintptr_t arg)</td>
<td>电子时间管理</td>
<td>可变参数</td>
</tr>
<tr>
<td>static void EsdWorkHandler(void *arg)</td>
<td>电子工作管理</td>
<td>可变参数</td>
</tr>
<tr>
<td>static void EsdCheckStartUp(struct DispEsd *esd, uint32_t devId)</td>
<td>启动电子检查</td>
<td>显示电子信息 显示Id</td>
</tr>
<tr>
<td>static void EsdCheckEnd(struct DispEsd *esd, uint32_t devId)</td>
<td>关闭电子检查</td>
<td>显示电子信息 显示Id</td>
</tr>
<tr>
<td>static struct DispEsd *EsdResMalloc(int32_t panelNum)</td>
<td>分配电子内存空间</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static void EsdMemFree(struct DispEsd *esd)</td>
<td>释放电子内存空间</td>
<td>显示电子信息</td>
</tr>
<tr>
<td>static int32_t EsdResInit(struct DispEsd *esd, struct PanelData **panel)</td>
<td>电子初始化</td>
<td>屏幕数据</td>
</tr>
<tr>
<td>static int32_t EsdCheckInit(struct DispManager *disp)</td>
<td>电子检查初始化</td>
<td>显示管理信息</td>
</tr>
<tr>
<td>static int32_t DispManagerInit(struct PanelManager *panelManager)</td>
<td>显示管理初始化</td>
<td>屏幕管理信息</td>
</tr>
<tr>
<td>static int32_t HdfDispEntryInit(struct HdfDeviceObject *object)</td>
<td>Hdf显示初始化入口</td>
<td>Hdf设备对象</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">static int32_t EsdResInit(struct DispEsd *esd, struct PanelData **panel)</span><br><span class="line">&#123;</span><br><span class="line">    uint32_t i;</span><br><span class="line">    int32_t ret;</span><br><span class="line"></span><br><span class="line">    for (i = 0; i &lt; esd-&gt;panelNum; i++) &#123;</span><br><span class="line">        if ((panel[i]-&gt;esd != NULL) &amp;&amp; panel[i]-&gt;esd-&gt;support) &#123;</span><br><span class="line">            esd-&gt;panelEsd[i] = panel[i]-&gt;esd;//获取防静电信息</span><br><span class="line">            esd-&gt;work[i] = (HdfWork *)OsalMemCalloc(sizeof(HdfWork));//申请work空间</span><br><span class="line">            if (esd-&gt;work[i] == NULL) &#123;</span><br><span class="line">                HDF_LOGE(&quot;%s work malloc fail&quot;, __func__);</span><br><span class="line">                EsdMemFree(esd);</span><br><span class="line">                return HDF_FAILURE;</span><br><span class="line">            &#125;</span><br><span class="line">            esd-&gt;timer[i] = (OsalTimer *)OsalMemCalloc(sizeof(OsalTimer));//申请timer空间</span><br><span class="line">            if (esd-&gt;timer[i] == NULL) &#123;</span><br><span class="line">                EsdMemFree(esd);</span><br><span class="line">                HDF_LOGE(&quot;%s timer malloc fail&quot;, __func__);</span><br><span class="line">                return HDF_FAILURE;</span><br><span class="line">            &#125;</span><br><span class="line">            if (esd-&gt;panelEsd[i]-&gt;interval &lt; ESD_DEFAULT_INTERVAL) &#123;</span><br><span class="line">                //令静电间隙等于ESD_DEFAULT_INTERVAL 5000</span><br><span class="line">                esd-&gt;panelEsd[i]-&gt;interval = ESD_DEFAULT_INTERVAL;</span><br><span class="line">            &#125;</span><br><span class="line">            ret = HdfWorkInit(esd-&gt;work[i], EsdWorkHandler, (void *)i);</span><br><span class="line">            if (ret != HDF_SUCCESS) &#123;</span><br><span class="line">                EsdMemFree(esd);</span><br><span class="line">                HDF_LOGE(&quot;%s HdfWorkInit fail&quot;, __func__);</span><br><span class="line">                return HDF_FAILURE;</span><br><span class="line">            &#125;</span><br><span class="line">            esd-&gt;workInit[i] = true;</span><br><span class="line">            esd-&gt;panelEsd[i]-&gt;state = ESD_READY;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return HDF_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>hdf_drm_panel.h &amp; hdf_drm_panel.c</li>
</ul>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>static inline struct HdfDrmPanel *ToHdfDrmPanel(const struct drm_panel *panel)</td>
<td>获取HdfDrmPanel</td>
<td>drm_panel信息</td>
</tr>
<tr>
<td>static int HdfDrmPanelUnprepare(struct drm_panel *panel)</td>
<td>HdfDrmPanel反准备</td>
<td>drm_panel信息</td>
</tr>
<tr>
<td>static int HdfDrmPanelPrepare(struct drm_panel *panel)</td>
<td>HdfDrmPanel准备</td>
<td>drm_panel信息</td>
</tr>
<tr>
<td>static int HdfDrmPanelDisable(struct drm_panel *panel)</td>
<td>HdfDrmPanel 关闭</td>
<td>drm_panel信息</td>
</tr>
<tr>
<td>static int HdfDrmPanelEnable(struct drm_panel *panel)</td>
<td>HdfDrmPanel 开启</td>
<td>drm_panel信息</td>
</tr>
<tr>
<td>static int HdfDrmPanelGetModes(struct drm_panel *panel, struct drm_connector *connector)</td>
<td>HdfDrmPanel获取模式</td>
<td>drm_panel信息</td>
</tr>
<tr>
<td>static ssize_t SuspendStore(struct device *dev,struct device_attribute *attr, const char *buf, size_t count)</td>
<td>暂停存储</td>
<td>设备信息 设备自定义属性 缓存信息 缓存标签</td>
</tr>
<tr>
<td>static ssize_t ResumeStore(struct device *dev,struct device_attribute *attr, const char *buf, size_t count)</td>
<td>恢复存储</td>
<td>设备信息 设备自定义属性 缓存信息 缓存标签</td>
</tr>
<tr>
<td>static ssize_t BacklightStore(struct device *dev,struct device_attribute *attr, const char *buf, size_t count)</td>
<td>背光存储</td>
<td>设备信息 设备自定义属性 缓存信息 缓存标签</td>
</tr>
<tr>
<td>static void CreateDrmMode(struct HdfDrmPanel *hdfDrmPanel)</td>
<td>创建Drm模式</td>
<td>Hdf DrmPanel信息</td>
</tr>
<tr>
<td>static struct HdfDrmPanel *InstanceHdfDrmPanel(struct DispManager *manager, int32_t index)</td>
<td>HdfDrmPanel实例化</td>
<td>显示管理 屏幕索引</td>
</tr>
<tr>
<td>int32_t HdfDrmPanelEntryInit(struct HdfDeviceObject *object)</td>
<td>HdfDrmPanel初始化入口</td>
<td>Hdf设备对象</td>
</tr>
</tbody></table>
<p><img data-src="https://img-blog.csdnimg.cn/d75bc0766a2643ae85f7c11e8a509f31.png#pic_center" alt="在这里插入图片描述"></p>
<h3 id="drivers-interface"><a href="#drivers-interface" class="headerlink" title="drivers_interface"></a>drivers_interface</h3><p>将以下实例中的idl文件移动到发布目录&#x2F;&#x2F;drivers&#x2F;interface&#x2F;foo&#x2F;v1.0&#x2F;.</p>
<h4 id="idl文件"><a href="#idl文件" class="headerlink" title="idl文件"></a>idl文件</h4><h5 id="idl文件背景"><a href="#idl文件背景" class="headerlink" title="idl文件背景"></a>idl文件背景</h5><p>客户端和服务器通信时，需要定义双方都认可的接口，用于保障双方可以正常通信，HarmonyOS IDL（HarmonyOS Interface Definition Language）就是一种定义此类接口的工具。<br>HarmonyOS IDL 先把需要传递的对象分解成操作系统能够理解的基本类型，并根据开发者的需求封装跨边界的对象。HarmonyOS IDL 接口包含面向应用程序的北向接口和面向硬件设备的南向接口</p>
<h4 id="将函数接口转换为idl"><a href="#将函数接口转换为idl" class="headerlink" title="将函数接口转换为idl"></a>将函数接口转换为idl</h4><ol>
<li>idl-gen工具转换<br><span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20vbXV4aWFveGltdXhpYW94aS9kcml2ZXJzX2ZyYW1ld29yay90cmVlL21hc3Rlci90b29scy9pZGwtZ2VuL2RvY3M=">idl-gen工具使用</span><br>注意 idl-gen工具只能帮助完成部分转换工作，生成文件不能直接用于编译，还需要进行手工修改。<br>转换命令格式如下：</li>
</ol>
<p><strong>python3 idl_generator.py -f &lt;*.h&gt; -o <directory></strong><br>对应本实例中的foo模块转换命令与输出：<br>~&#x2F;temp &gt; python3 ~&#x2F;code&#x2F;01-ohos_master&#x2F;drivers&#x2F;framework&#x2F;tools&#x2F;idl-gen&#x2F;idl_generator.py -f foo_idl&#x2F;ifoo.h -o foo&#x2F;v1.0&#x2F;<br>Generate: ——— foo&#x2F;v1.0&#x2F;foo_idl&#x2F;IFoo.idl ———<br>Generate: ——— foo&#x2F;v1.0&#x2F;foo_idl&#x2F;IFooCallback.idl ———–<br>Generate: ——— foo&#x2F;v1.0&#x2F;foo_idl&#x2F;Types.idl ———</p>
<p>生成文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">foo</span><br><span class="line">└── v1.0</span><br><span class="line">    └── foo_idl</span><br><span class="line">        ├── IFoo.idl</span><br><span class="line">        ├── IFooCallback.idl</span><br><span class="line">        └── Types.idl</span><br><span class="line">IFoo.idl :</span><br><span class="line"></span><br><span class="line">package foo_idl;</span><br><span class="line"></span><br><span class="line">import foo_idl.IFooCallback;</span><br><span class="line">import foo_idl.Types;</span><br><span class="line"></span><br><span class="line">interface IFoo &#123;</span><br><span class="line">    Ping([in] String sendMsg,[in] String recvMsg);</span><br><span class="line">    GetData([in] struct FooInfo info);</span><br><span class="line">    SetCallback([in] IFooCallback cbObj);</span><br><span class="line">&#125;</span><br><span class="line">IFooCallback.idl :</span><br><span class="line"></span><br><span class="line">package foo_idl;</span><br><span class="line"></span><br><span class="line">[callback] interface IFooCallback &#123;</span><br><span class="line">    PushData([in] String message);</span><br><span class="line">&#125;</span><br><span class="line">Types.idl :</span><br><span class="line"></span><br><span class="line">package foo_idl;</span><br><span class="line"></span><br><span class="line">enum FooType &#123;</span><br><span class="line">    FOO_TYPE_ONE = 1,</span><br><span class="line">    FOO_TYPE_TWO = 2,</span><br><span class="line">&#125;;</span><br><span class="line">struct FooInfo &#123;</span><br><span class="line">    unsigned int id;</span><br><span class="line">    String name;</span><br><span class="line">    enum FooType type;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>可以看到生成内容基本符合头文件中的接口定义，但是仍然需要一些手动修正，</p>
<p>工具无法对参数方向[in&#x2F;out]准确标记，因为工具难以根据C&#x2F;C++代码推断出参数方向，需要手动修改标记<br>可能存在通过include难以分析到的数据类型，需要手动补全<br>生成的包名需要进行检查，统一应该为OHOS.HDI.模块名.版本，且需要与路径对应<br>手工对IFoo.idl修正如下,主要是将in&#x2F;out方向标注正确 :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">package ohos.hdi.foo.v1_0;</span><br><span class="line"></span><br><span class="line">import ohos.hdi.foo.v1_0.IFooCallback;</span><br><span class="line">import ohos.hdi.foo.v1_0.Types;</span><br><span class="line"></span><br><span class="line">interface IFoo &#123;</span><br><span class="line">    Ping([in] String sendMsg,[out] String recvMsg);</span><br><span class="line">    GetData([out] struct FooInfo info);</span><br><span class="line">    SetCallback([in] IFooCallback cbObj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>根据idl语法手动编写idl文件<br><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuaGFybW9ueW9zLmNvbS9jbi9kb2NzL2RvY3VtZW50YXRpb24vZG9jLXJlZmVyZW5jZXMvaWRsLWZpbGUtc3RydWN0dXJlLTAwMDAwMDEwNTA3MjI4MDY=">idl语法</span></li>
</ol>
<h4 id="编译idl"><a href="#编译idl" class="headerlink" title="编译idl"></a>编译idl</h4><ol>
<li>为idl创建BUILD.gn编译脚本</li>
</ol>
<p>该实例的gn文件为&#x2F;&#x2F;drivers&#x2F;interface&#x2F;foo&#x2F;v1.0&#x2F;BUILD.gn，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import(&quot;//drivers/adapter/uhdf2/hdi.gni&quot;) # 编译idl必须要导入的模板</span><br><span class="line"></span><br><span class="line">if (defined(ohos_lite)) &#123;</span><br><span class="line">  group(&quot;libfoo_proxy_1.0&quot;) &#123;</span><br><span class="line">    deps = []</span><br><span class="line">    public_configs = []</span><br><span class="line">  &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">hdi(&quot;foo&quot;) &#123;                                # 目标名称，会生成两个so: libfoo_[proxy/stub]_1.0.z.so</span><br><span class="line">    module_name = &quot;foo&quot;                     # module_name匹配dirver文件中驱动描述符(HdfDriverEntry)的moduleName</span><br><span class="line">    sources = [                             # 参与编译的idl文件</span><br><span class="line">        &quot;IFoo.idl&quot;,                         # 接口idl</span><br><span class="line">        &quot;IFooCallback.idl&quot;,                 # 用于回调的idl</span><br><span class="line">        &quot;Types.idl&quot;,                      # 自定义类型idl</span><br><span class="line">    ]</span><br><span class="line">    language = &quot;cpp&quot;                        # 控制idl生成c或c++代码 可选择`c`或`cpp`</span><br><span class="line">    subsystem_name = &quot;hdf&quot;                  # 子系统，统一填写“hdf”</span><br><span class="line">    part_name = &quot;foo_device_driver&quot;         # 部件名，如果不属于已有部件，则需要定义新的部件</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>修改相应外设仓(drivers\peripheral\foo)下的BUILD.gn文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import(&quot;//build/ohos.gni&quot;)</span><br><span class="line">import(&quot;//drivers/adapter/uhdf2/uhdf.gni&quot;)</span><br><span class="line"></span><br><span class="line">group(&quot;foo_entry&quot;) &#123;</span><br><span class="line">  deps = [</span><br><span class="line">    &quot;interfaces/hdi_callback:libfoo_callback&quot;,</span><br><span class="line">    &quot;interfaces/hdi_service:hdf_foo&quot;,</span><br><span class="line">    &quot;//drivers/interface/foo/v1_0:foo&quot;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改相应外设仓(drivers\peripheral\foo)下的bundle.json文件</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;power_device_driver&quot;,</span><br><span class="line">    &quot;description&quot;: &quot;power_hdf&quot;,</span><br><span class="line">    &quot;version&quot;: &quot;3.1&quot;,</span><br><span class="line">    &quot;license&quot;: &quot;Apache License 2.0&quot;,</span><br><span class="line">    &quot;component&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;power_device_driver&quot;,</span><br><span class="line">      &quot;subsystem&quot;: &quot;hdf&quot;,</span><br><span class="line">      &quot;syscap&quot;: [ &quot;&quot; ],</span><br><span class="line">      &quot;adapter_system_type&quot;: [&quot;standard&quot;, &quot;small&quot;],</span><br><span class="line">      &quot;rom&quot;: &quot;981KB&quot;,</span><br><span class="line">      &quot;ram&quot;: &quot;6000KB&quot;,</span><br><span class="line">      &quot;deps&quot;: &#123;</span><br><span class="line">        &quot;components&quot;: [</span><br><span class="line">          &quot;device_driver_framework&quot;,</span><br><span class="line">          &quot;hiviewdfx_hilog_native&quot;,</span><br><span class="line">          &quot;ipc&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;third_part&quot;: [</span><br><span class="line">          &quot;xml2&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;build&quot;: &#123;</span><br><span class="line">        &quot;sub_component&quot;: [</span><br><span class="line">          &quot;//drivers/peripheral/foo:foo_entry&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;inner_kits&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;name&quot;: &quot;//drivers/interface/foo/v1_0:libpower_foo_1.0&quot;,</span><br><span class="line">            &quot;header&quot;: &#123;</span><br><span class="line">              &quot;header_files&quot;: [</span><br><span class="line">                  &quot;foo_hdi_callback_impl.h&quot;</span><br><span class="line">              ],</span><br><span class="line">              &quot;header_base&quot;: &quot;//drivers/peripheral/foo/interfaces/include&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<ol start="4">
<li>编译idl生成目标源码</li>
</ol>
<p>经过上述修改，编译foo_device_driver_interface部件，对idl编译进行排错：</p>
<p> <strong>.&#x2F;build.sh –product-name rk3568 –ccache –build-target foo_device_driver_interface</strong> （指定编）</p>
<p> <strong>.&#x2F;build.sh –product-name rk3568 –ccache</strong> (全仓编)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">编译成功后可以在out目录看到生成文件：</span><br><span class="line"></span><br><span class="line">out/rk3568/gen/drivers/interface/foo</span><br><span class="line">└── v1_0</span><br><span class="line">    ├── foo_callback_proxy.cpp      // 回调接口客户端实现</span><br><span class="line">    ├── foo_callback_proxy.h        // 回调接口客户端头文件</span><br><span class="line">    ├── foo_callback_service.cpp    // 回调接口服务实现参考</span><br><span class="line">    ├── foo_callback_service.h      // 回调接口服务实现接口头文件</span><br><span class="line">    ├── foo_callback_stub.cpp       // 回调接口服务端实现</span><br><span class="line">    ├── foo_callback_stub.h         // 回调接口服务端头文件</span><br><span class="line">    ├── foo_driver.cpp              // 驱动入口参考实现</span><br><span class="line">    ├── foo_proxy.cpp               // 客户端实现</span><br><span class="line">    ├── foo_proxy.h                 // 客户端头文件</span><br><span class="line">    ├── foo_service.cpp             // 服务参考实现</span><br><span class="line">    ├── foo_service.h               // 服务实现接口头文件</span><br><span class="line">    ├── foo_stub.cpp                // 服务端实现</span><br><span class="line">    ├── foo_stub.h                  // 服务端头文件</span><br><span class="line">    ├── ifoo.h                      // C/C++接口定义头文件</span><br><span class="line">    ├── ifoo_callback.h             // C/C++回调接口定义头文件</span><br><span class="line">    ├── types.cpp                   // 数据序列化、反序列化实现</span><br><span class="line">    └── types.h                     // C/C++数据类型定义头文件</span><br><span class="line">其中foo_driver.cpp和foo_callback_service.cpp为驱动入口和服务实现的参考实现，如果需要可以直接使用。</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="drivers-liteos"><a href="#drivers-liteos" class="headerlink" title="drivers_liteos"></a>drivers_liteos</h3><p>内核驱动是软件与硬件交互的桥梁，通过文件系统接口访问OpenHarmony内核的硬件资源，是用户与内核之间、进程与进程之间通信的一种方式。每类驱动代表一种能力，用户可以根据需求选择对应驱动，完成数据的传输。内核初始化驱动并注册设备节点，用户通过文件系统接口操作该设备节点。内核驱动主要包括mem、random、video、quickstart、hievent和tzdriver，其中mem、random、video和quickstart位于kernel&#x2F;liteos_a&#x2F;drivers&#x2F;char目录下，hievent和tzdrivert位于drivers&#x2F;liteos目录下</p>
<h3 id="drivers-peripheral"><a href="#drivers-peripheral" class="headerlink" title="drivers_peripheral"></a>drivers_peripheral</h3><p>该仓下源代码目录结构如下所示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/drivers/peripheral/display</span><br><span class="line">├── hal                # display模块的hal层代码</span><br><span class="line">│   └── default       # display模块hdi的默认实现</span><br><span class="line">├── hdi_service         # display模块</span><br><span class="line">│   └── device       # display模块设备管理</span><br><span class="line">│   └── gralloc       # display模块的模块内存管理</span><br><span class="line">│   └── video_layer       # display模块的图层管理</span><br><span class="line">├── interfaces         # display模块对上层服务提供的驱动能力接口</span><br><span class="line">│   └── include       # display模块对外提供的接口定义</span><br><span class="line">├── test               # display模块的测试代码</span><br><span class="line">│   └── unittest      # display模块的单元测试代码</span><br></pre></td></tr></table></figure>


<h4 id="interfaces-x2F-include-接口说明"><a href="#interfaces-x2F-include-接口说明" class="headerlink" title="interfaces&#x2F;include 接口说明"></a>interfaces&#x2F;include 接口说明</h4><p>Display驱动提供给系统服务WMS可直接调用的驱动能力接口，按照功能分类三大类：显示图层子模块、显示内存子模块、硬件加速子模块，可以提供图层的创建和销毁、图层属性的设置，内存的申请和释放、映射和缓冲，矩形填充和位图搬移等能力。</p>
<p>display_layer.h</p>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>int32_t (*InitDisplay)(uint32_t devId);</td>
<td>显示屏初始化</td>
<td>显示id</td>
</tr>
<tr>
<td>int32_t (*DeinitDisplay)(uint32_t devId);</td>
<td>显示屏反初始化</td>
<td>显示id</td>
</tr>
<tr>
<td>int32_t (*GetDisplayInfo)(uint32_t devId, DisplayInfo *dispInfo);</td>
<td>获取显示信息</td>
<td>显示id displayinfo信息</td>
</tr>
<tr>
<td>int32_t (*OpenLayer)(uint32_t devId, const LayerInfo *layerInfo, uint32_t *layerId);</td>
<td>创建layer图层</td>
<td>显示id 图层info信息 图层id</td>
</tr>
<tr>
<td>int32_t (*CloseLayer)(uint32_t devId, uint32_t layerId);</td>
<td>销毁layer图层</td>
<td>显示id 图层id</td>
</tr>
<tr>
<td>int32_t (*SetLayerVisible)(uint32_t devId, uint32_t layerId, bool visible);</td>
<td>设置layer是否可见</td>
<td>显示id 图层id 是否可见参数</td>
</tr>
<tr>
<td>int32_t (*SetLayerDirtyRegion)(uint32_t devId, uint32_t layerId, IRect *region);</td>
<td>设置layer刷新区域</td>
<td>显示id 图层id 区域信息</td>
</tr>
<tr>
<td>int32_t (*Flush)(uint32_t devId, uint32_t layerId, LayerBuffer *buffer);</td>
<td>刷新图层</td>
<td>显示id 图层id 图层buffer</td>
</tr>
<tr>
<td>int32_t (*GetLayerBuffer)(uint32_t devId, uint32_t layerId, LayerBuffer *buffer);</td>
<td>获取图层buffer</td>
<td>显示id 图层id 图层buffer</td>
</tr>
</tbody></table>
<p>display_gralloc.h</p>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>int32_t (<em>AllocMem)(const AllocInfo</em> info, BufferHandle** handle);</td>
<td>显示内存分配</td>
<td>alloc info信息 buffer句柄</td>
</tr>
<tr>
<td>void (*FreeMem)(BufferHandle *handle);</td>
<td>显示内存释放</td>
<td>buffer句柄</td>
</tr>
<tr>
<td>void *(*Mmap)(BufferHandle *handle);</td>
<td>内存映射</td>
<td>buffer句柄</td>
</tr>
<tr>
<td>void *MmapCache(BufferHandle *buffer);</td>
<td>内存映射为cache</td>
<td>buffer句柄</td>
</tr>
<tr>
<td>int32_t Unmap(BufferHandle *buffer);</td>
<td>取消内存映射</td>
<td>buffer句柄</td>
</tr>
<tr>
<td>int32_t FlushCache(BufferHandle *buffer);</td>
<td>刷新cache里的内容到内存并且使cache里的内容无效</td>
<td>buffer句柄</td>
</tr>
<tr>
<td>int32_t FlushMCache(BufferHandle *buffer);</td>
<td>刷新Mmap映射的cache里的内容到内存并且使cache里的内容无效</td>
<td>buffer句柄</td>
</tr>
<tr>
<td>int32_t (<em>InvalidateCache)(BufferHandle</em> handle);</td>
<td>使缓存内容失效，直接从内存中更新</td>
<td>buffer句柄</td>
</tr>
<tr>
<td>int32_t (*IsSupportedAlloc)(uint32_t num, const VerifyAllocInfo *infos, bool *supporteds);</td>
<td>检查VerifyAllocInfo数组是否可分配</td>
<td>info数组大小 erifyAllocInfo数组的指针 可分配数组的指针</td>
</tr>
</tbody></table>
<p>display_gfx.h</p>
<table>
<thead>
<tr>
<th>函数原型</th>
<th>函数功能</th>
<th>参数功能</th>
</tr>
</thead>
<tbody><tr>
<td>int32_t InitGfx(void);</td>
<td>初始化硬件加速</td>
<td>无</td>
</tr>
<tr>
<td>int32_t DeinitGfx(void);</td>
<td>反初始化硬件加速</td>
<td>无</td>
</tr>
<tr>
<td>int32_t Blit(ISurface *srcSurface, IRect *srcRect, ISurface *dstSurface, IRect *dstRect);</td>
<td>位图搬移</td>
<td>源位图指针 源位图矩形指针 目标位图指针 目标位图矩形指针 硬件加速选项指针</td>
</tr>
<tr>
<td>int32_t FillRect(ISurface *surface, IRect *rect, uint32_t color, GfxOpt *opt);</td>
<td>绘制矩形框</td>
<td>矩形框指针 要填充矩形指针 要填充的颜色 硬件加速选项指针</td>
</tr>
<tr>
<td>int32_t (*DrawRectangle)(ISurface *surface, Rectangle *rect, uint32_t color, GfxOpt *opt);</td>
<td>绘制给定颜色的矩形框</td>
<td>矩形框指针 要绘制的矩形的指针 要填充的颜色 硬件加速选项指针</td>
</tr>
<tr>
<td>int32_t (*DrawLine)(ISurface *surface, ILine *line, GfxOpt *opt);</td>
<td>用给定的颜色画直线</td>
<td>矩形框指针 绘制的线的指针 硬件加速选项的指针</td>
</tr>
<tr>
<td>int32_t (*DrawCircle)(ISurface *surface, ICircle *circle, GfxOpt *opt);</td>
<td>使用指定颜色绘制指定中心和半径的圆</td>
<td>矩形框指针 要绘制的圆的指针 硬件加速选项的指针</td>
</tr>
<tr>
<td>int32_t (*Sync)(int32_t timeOut);</td>
<td>阻塞进程，直到硬件加速完成</td>
<td>硬件加速同步超时时间</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">int DisplayServiceSample(void)</span><br><span class="line">&#123;    </span><br><span class="line">    int32_t ret;</span><br><span class="line">    g_displayTest.devId = DEVID;</span><br><span class="line"></span><br><span class="line">    /* 获取display驱动接口 */</span><br><span class="line">    ret = GetDisplayInterfaces();</span><br><span class="line">    if (ret != DISPLAY_SUCCESS) &#123;</span><br><span class="line">        HDF_LOGE(&quot;get display interfaces ops failed&quot;);</span><br><span class="line">        return ret;</span><br><span class="line">    &#125;</span><br><span class="line">    /* 初始化显示设备 */</span><br><span class="line">    if (g_displayTest.layerFuncs-&gt;InitDisplay != NULL) &#123;</span><br><span class="line">        ret = g_displayTest.layerFuncs-&gt;InitDisplay(g_displayTest.devId);</span><br><span class="line">        if (ret != DISPLAY_SUCCESS) &#123;</span><br><span class="line">            HDF_LOGE(&quot;initialize display failed&quot;);</span><br><span class="line">            return DISPLAY_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /* 获取显示设备的信息 */</span><br><span class="line">    if (g_displayTest.layerFuncs-&gt;GetDisplayInfo != NULL) &#123;</span><br><span class="line">        ret = g_displayTest.layerFuncs-&gt;GetDisplayInfo(g_displayTest.devId, &amp;g_displayTest.displayInfo);</span><br><span class="line">        if (ret != DISPLAY_SUCCESS) &#123;</span><br><span class="line">            HDF_LOGE(&quot;get disp info failed&quot;);</span><br><span class="line">            return DISPLAY_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /* 打开显示设备的特定图层 */</span><br><span class="line">    if (g_displayTest.layerFuncs-&gt;OpenLayer != NULL) &#123;</span><br><span class="line">        LayerInfo layInfo;</span><br><span class="line">        GetLayerInfo(&amp;layInfo);</span><br><span class="line">        ret = g_displayTest.layerFuncs-&gt;OpenLayer(g_displayTest.devId, &amp;layInfo, &amp;g_displayTest.layerId);</span><br><span class="line">        if (ret != DISPLAY_SUCCESS) &#123;</span><br><span class="line">            HDF_LOGE(&quot;open layer failed&quot;);</span><br><span class="line">            return DISPLAY_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /* 获取图层buffer并填充buffer */</span><br><span class="line">    if (g_displayTest.layerFuncs-&gt;GetLayerBuffer != NULL) &#123;</span><br><span class="line">        ret = g_displayTest.layerFuncs-&gt;GetLayerBuffer(g_displayTest.devId, g_displayTest.layerId, &amp;g_displayTest.buffer);</span><br><span class="line">        if (ret != DISPLAY_SUCCESS) &#123;</span><br><span class="line">            HDF_LOGE(&quot;get layer buffer failed&quot;);</span><br><span class="line">            return DISPLAY_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line">        uint16_t *pBuf = (uint16_t *)g_displayTest.buffer.data.virAddr;</span><br><span class="line">        WriteDataToBuf(g_displayTest.displayInfo.width, g_displayTest.displayInfo.height, pBuf);</span><br><span class="line">    &#125;</span><br><span class="line">    /* 刷新图层数据进行显示 */</span><br><span class="line">    if (g_displayTest.layerFuncs-&gt;Flush != NULL) &#123;</span><br><span class="line">        ret = g_displayTest.layerFuncs-&gt;Flush(g_displayTest.devId, g_displayTest.layerId, &amp;g_displayTest.buffer);</span><br><span class="line">        if (ret != DISPLAY_SUCCESS) &#123;</span><br><span class="line">            HDF_LOGE(&quot;flush layer failed&quot;);</span><br><span class="line">            return DISPLAY_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /* 关闭显示设备的特定图层 */</span><br><span class="line">    if (g_displayTest.layerFuncs-&gt;CloseLayer != NULL) &#123;</span><br><span class="line">        ret = g_displayTest.layerFuncs-&gt;CloseLayer(g_displayTest.devId, g_displayTest.layerId);</span><br><span class="line">        if (ret != DISPLAY_SUCCESS) &#123;</span><br><span class="line">            HDF_LOGE(&quot;close layer failed&quot;);</span><br><span class="line">            return DISPLAY_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /* 关闭显示设备 */</span><br><span class="line">    if (g_displayTest.layerFuncs-&gt;DeinitDisplay != NULL) &#123;</span><br><span class="line">        ret = g_displayTest.layerFuncs-&gt;DeinitDisplay(g_displayTest.devId);</span><br><span class="line">        if (ret != DISPLAY_SUCCESS) &#123;</span><br><span class="line">            HDF_LOGE(&quot;deinit display failed&quot;);</span><br><span class="line">            return DISPLAY_FAILURE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    /* 注销显示驱动接口 */</span><br><span class="line">    ret = DisplayUninit();</span><br><span class="line">    if (ret != DISPLAY_SUCCESS) &#123;</span><br><span class="line">        HDF_LOGE(&quot;DisplayUninit fail&quot;);</span><br><span class="line">        return ret;</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2024-10-20 12:33:51" itemprop="dateModified" datetime="2024-10-20T12:33:51+08:00">2024-10-20</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> Donate</button>
  <p>Give me a cup of [coffee]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="迩彧 WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="迩彧 Alipay">
        <p>Alipay</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>迩彧 <i class="ic i-at"><em>@</em></i>迩彧博客
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="https://muxiaoximuxiaoxi.github.io/2024/10/20/display%E6%A8%A1%E5%9D%97%E8%AE%B2%E8%A7%A3/" title="">https://muxiaoximuxiaoxi.github.io/2024/10/20/display模块讲解/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2024/04/28/%E6%89%93%E5%8C%85%E5%8F%91%E7%89%88/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclxp31goj20zk0m8qv5.jpg" title="打包发版">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> _视联云桌面</span>
  <h3>打包发版</h3>
  </a>

    </div>
    <div class="item right">
    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#x3D"><span class="toc-number">1.</span> <span class="toc-text">&#x3D;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#driver"><span class="toc-number">1.1.</span> <span class="toc-text">driver</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#drivers-adapter"><span class="toc-number">1.2.</span> <span class="toc-text">drivers_adapter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#drivers-framework"><span class="toc-number">1.3.</span> <span class="toc-text">drivers_framework</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#drivers-framework-x2F-model-x2F-display-x2F-driver"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">drivers_framework&#x2F; model &#x2F; display &#x2F; driver</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#drivers-interface"><span class="toc-number">1.4.</span> <span class="toc-text">drivers_interface</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#idl%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text">idl文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#idl%E6%96%87%E4%BB%B6%E8%83%8C%E6%99%AF"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">idl文件背景</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E5%87%BD%E6%95%B0%E6%8E%A5%E5%8F%A3%E8%BD%AC%E6%8D%A2%E4%B8%BAidl"><span class="toc-number">1.4.2.</span> <span class="toc-text">将函数接口转换为idl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E8%AF%91idl"><span class="toc-number">1.4.3.</span> <span class="toc-text">编译idl</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#drivers-liteos"><span class="toc-number">1.5.</span> <span class="toc-text">drivers_liteos</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#drivers-peripheral"><span class="toc-number">1.6.</span> <span class="toc-text">drivers_peripheral</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#interfaces-x2F-include-%E6%8E%A5%E5%8F%A3%E8%AF%B4%E6%98%8E"><span class="toc-number">1.6.1.</span> <span class="toc-text">interfaces&#x2F;include 接口说明</span></a></li></ol></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="迩彧"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">迩彧</p>
  <div class="description" itemprop="description">与其临渊羡鱼，不如退而结网</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">22</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">5</span>
        <span class="name">categories</span>
      </a>
    </div>
</nav>

<div class="social">
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%86%E8%81%94%E4%BA%91%E6%A1%8C%E9%9D%A2/" title="In _视联云桌面">_视联云桌面</a>
</div>

    <span><a href="/2024/04/28/%E6%89%93%E5%8C%85%E5%8F%91%E7%89%88/" title="打包发版">打包发版</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/tv%E5%AD%90%E7%B3%BB%E7%BB%9F/" title="In _tv子系统">_tv子系统</a>
</div>

    <span><a href="/2024/04/28/Android%20IPC%20%E4%B9%8B%20AIDL/" title="Android IPC 之 AIDL">Android IPC 之 AIDL</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%86%E8%81%94%E6%B5%8F%E8%A7%88%E5%99%A8/" title="In _视联浏览器">_视联浏览器</a>
</div>

    <span><a href="/2024/02/23/bind9%E5%85%B3%E4%BA%8E%E8%A7%86%E8%81%94%E7%BD%91%E7%A7%BB%E6%A4%8D/" title="bind9关于视联网移植">bind9关于视联网移植</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%86%E8%81%94%E6%B5%8F%E8%A7%88%E5%99%A8/" title="In _视联浏览器">_视联浏览器</a>
</div>

    <span><a href="/2024/02/23/%E8%A7%86%E8%81%94%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87/" title="视联浏览器双机热备">视联浏览器双机热备</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2024/10/20/display%E6%A8%A1%E5%9D%97%E8%AE%B2%E8%A7%A3/" title="Untitled">Untitled</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%86%E8%81%94SDK/" title="In _视联SDK">_视联SDK</a>
</div>

    <span><a href="/2024/03/22/TVL%E6%A0%BC%E5%BC%8F/" title="TVL格式">TVL格式</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E9%A9%B1%E5%8A%A8%E5%AD%90%E7%B3%BB%E7%BB%9F/" title="In _驱动子系统">_驱动子系统</a>
</div>

    <span><a href="/2024/04/28/HDI-GEN%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AF%BC/" title="HDI-GEN使用指导">HDI-GEN使用指导</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/tv%E5%AD%90%E7%B3%BB%E7%BB%9F/" title="In _tv子系统">_tv子系统</a>
</div>

    <span><a href="/2024/04/28/JAVA%20native%E5%85%B3%E9%94%AE%E5%AD%97/" title="JNI">JNI</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%A7%86%E8%81%94%E6%B5%8F%E8%A7%88%E5%99%A8/" title="In _视联浏览器">_视联浏览器</a>
</div>

    <span><a href="/2024/02/23/%E6%A0%B9%E6%8D%AE%E7%8E%B0%E6%9C%89%E6%96%87%E4%BB%B6%E7%BC%96%E8%AF%91%E6%88%90so%EF%BC%8C%E5%B9%B6%E8%BF%9B%E8%A1%8C%E8%B0%83%E7%94%A8/" title="动态so的编译">动态so的编译</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E9%A9%B1%E5%8A%A8%E5%AD%90%E7%B3%BB%E7%BB%9F/" title="In _驱动子系统">_驱动子系统</a>
</div>

    <span><a href="/2024/04/28/rk3568%E6%B5%8B%E8%AF%95/" title="rk3568测试">rk3568测试</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">迩彧 @ Yume Shoka</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2024/10/20/display模块讲解/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
